# 资源修复

关于资源的修复方案，没有像代码修复一样方法繁多，基本上集中在对AssetManager 的修改上

7.1 替换 AssetManager
这个是 InstantRun 采用的方案，就是构造一个新的 AssetManager，反射调用其 addAssetPath 函数，把新的补丁资源包添加到 AssetManager 中，从而得到含有完整补丁资源的 AssetManager，然后找到所有引用 AssetManager 的地方，通过反射将其替换为新的 AssetManager。

7.2 添加修改的资源到 AssetManager 中，并重新初始化
这个是 Sophix 采用的方案，原理是构造一个 package id 为 0x66 的资源包，只含有改变的资源，将其直接添加到原有的 AssetManager 中，这样不会与原来的 package id 0x7f 冲突。然后将原来的 AssetManager 重新进行初始化即可，就不需要进行繁琐的反射替换操作了。

## 原理


## 实现

替换Resources中的AssetManager对象
Android N，替换的是Resources对象中的mResourcesImpl成员变量中的mAssets成员变量。
Android N以前，替换的是Resources对象中的mAssets成员变量。

https://blog.csdn.net/sbsujjbcy/article/details/52541803

```Java


```




## 资源打包

在sdk/build.tools目录下有一个aapt.exe工具，它的作用就是在打包apk的过程中帮我们处理资源文件(res、assets、manifest)并打进一个名为`resources.ap_`的压缩包，可在build/intermediates/res路径下找到它，将其解压，可以得到res文件夹、assets文件夹、AndroidManifest.xml、resources.arsc。

resources.arsc是一张资源索引表，代码中使用R.xx.xx都会通过arsc索引表找对应的资源，可使用`AssetManager.addAssetPath()`加载它。

https://github.com/Tencent/tinker

https://blog.csdn.net/l2show/article/details/53454933

记一次苦逼的资源逆向分析 http://zjutkz.net/2016/05/15/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%8B%A6%E9%80%BC%E7%9A%84%E8%B5%84%E6%BA%90%E9%80%86%E5%90%91%E5%88%86%E6%9E%90/


https://my.oschina.net/bugly/blog/727850


https://blog.csdn.net/luoshengyang/article/details/8791064

https://www.imooc.com/article/251911

